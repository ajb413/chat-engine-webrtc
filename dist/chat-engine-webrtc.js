(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';(function(){var a=require('../package.json');window.ChatEngineCore.plugin[a.name]=require('../src/plugin.js')})();

},{"../package.json":2,"../src/plugin.js":5}],2:[function(require,module,exports){
module.exports={
  "author": "Adam Bavosa",
  "name": "chat-engine-webrtc",
  "version": "0.0.1",
  "main": "src/plugin.js",
  "dependencies": {
    "chat-engine": "^0.9.18"
  },
  "browserify": {
    "transform": [
      [
        "babelify",
        {
          "presets": [
            "es2015",
            "minify"
          ]
        }
      ]
    ]
  },
  "devDependencies": {
    "babel-core": "^6.26.3",
    "babel-minify": "^0.4.3",
    "babel-preset-es2015": "^6.24.1",
    "babelify": "^8.0.0"
  }
}
},{}],3:[function(require,module,exports){
'use strict';function onIncomingCallNotDefined(a){chatEngineError(this.ChatEngine,'onIncomingCallNotDefined','A handler for the [onIncomingCall] event is not defined.'),a(!1)}function onCallResponseNotDefined(){chatEngineError(this.ChatEngine,'onCallResponseNotDefined','A handler for the [onCallResponse] event is not defined.')}function onPeerStreamNotDefined(){chatEngineError(this.ChatEngine,'onPeerStreamNotDefined','A handler for the [onPeerStream] event is not defined.')}function onDisconnectNotDefined(){chatEngineError(this.ChatEngine,'onDisconnectNotDefined','A handler for the [onDisconnect] event is not defined.')}function chatEngineError(a,b,c,d){c='ChatEngine WebRTC Plugin: '+(c||'undefined error'),d=d?d:c,a.throwError(a,b,'webRTC',new Error(c),{error:d})}module.exports={onIncomingCallNotDefined:onIncomingCallNotDefined,onCallResponseNotDefined:onCallResponseNotDefined,onPeerStreamNotDefined:onPeerStreamNotDefined,onDisconnectNotDefined:onDisconnectNotDefined,chatEngineError:chatEngineError};

},{}],4:[function(require,module,exports){
'use strict';var peerIceCandidateEvent='$webRTC.peerIceCandidate',incomingCallEvent='$webRTC.incomingCall',callResponseEvent='$webRTC.callResponse';function uuid(){return'10000000-1000-4000-8000-100000000000'.replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}var eventNames={peerIceCandidateEvent:'$webRTC.peerIceCandidate',incomingCallEvent:'$webRTC.incomingCall',callResponseEvent:'$webRTC.callResponse'};module.exports={uuid:uuid,eventNames:eventNames};

},{}],5:[function(require,module,exports){
'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_errorHandlers=require('./helpers/error-handlers.js'),_util=require('./helpers/util.js');function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var incomingCallEvent=_util.eventNames.incomingCallEvent,callResponseEvent=_util.eventNames.callResponseEvent,peerIceCandidateEvent=_util.eventNames.peerIceCandidateEvent,config=void 0,WebRtcPhone=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:'construct',value:function b(){var a=this;this.onIncomingCall=config.onIncomingCall||_errorHandlers.onIncomingCallNotDefined,this.onCallResponse=config.onCallResponse||_errorHandlers.onCallResponseNotDefined,this.onPeerStream=config.onPeerStream||_errorHandlers.onPeerStreamNotDefined,this.onDisconnect=config.onDisconnect||_errorHandlers.onDisconnectNotDefined,this.myStream=config.myStream,this.rtcConfig=config.rtcConfig,this.ignoreNonTurn=config.ignoreNonTurn,this.ChatEngine.me.direct.on(incomingCallEvent,function(b){incomingCall.call(a,b)}),this.ChatEngine.me.direct.on(callResponseEvent,function(b){callResponse.call(a,b)}),this.ChatEngine.me.direct.on(peerIceCandidateEvent,function(b){peerIceCandidate.call(a,b)})}},{key:'callUser',value:function k(a,b){var c=this,d=b.onPeerStream,e=b.myStream,f=b.offerOptions,g=b.rtcConfig;g=this.rtcConfig=g||this.rtcConfig,e=this.myStream=e||this.myStream,d=this.onPeerStream=d||this.onPeerStream,f=f||{offerToReceiveAudio:1,offerToReceiveVideo:1};var h=this.peerConnection=new RTCPeerConnection(g),i=this.callId=(0,_util.uuid)(),j=void 0;h.ontrack=d,e.getTracks().forEach(function(a){h.addTrack(a,e)}),h.iceCache=[],h.oniceconnectionstatechange=function(){'disconnected'===h.iceConnectionState&&c.disconnect()},h.onicecandidate=function(b){b.candidate&&onIceCandidate(b,a,h,i)},h.onnegotiationneeded=function(){h.createOffer(f).then(function(a){return j=a,h.setLocalDescription(j)}).then(function(){a.direct.emit(incomingCallEvent,{callId:i,rtcConfig:g,description:j})}).catch(function(a){(0,_errorHandlers.chatEngineError)(c.ChatEngine,'callUser','WebRTC [callUser] error.',a)})}}},{key:'disconnect',value:function a(){this.peerConnection&&(this.peerConnection.close(),delete this.peerConnection),this.callInSession=!1,this.onDisconnect()}}]),a}();function callResponse(a){var b=this,c=a.data,d=c.callId,e=c.acceptedCall,f=a.data.description,g=a.sender;e&&(this.peerConnection.acceptedCall=!0,this.callInSession=!0,this.peerConnection.setRemoteDescription(f).then(function(){sendIceCandidates(g,b.peerConnection,d)}).catch(function(a){(0,_errorHandlers.chatEngineError)(b.ChatEngine,'callResponse','WebRTC [callResponse] error.',a)})),this.onCallResponse(e)}function incomingCall(a){var b=this,c=a.sender,d=a.data,e=d.callId,f=d.rtcConfig,g=a.data.description;this.onIncomingCall(c,function l(a){var d=a.acceptedCall,h=a.onPeerStream,i=a.myStream;if(i=b.myStream=i||b.myStream,h=h||b.onPeerStream,d){if('object'!==('undefined'==typeof i?'undefined':_typeof(i))){(0,_errorHandlers.chatEngineError)(b.ChatEngine,'incomingCall','WebRTC [incomingCall]:No local video stream defined.',error)}var j=void 0,k=b.peerConnection=new RTCPeerConnection(f);k.ontrack=h,k.iceCache=[],i.getTracks().forEach(function(a){k.addTrack(a,i)}),k.oniceconnectionstatechange=function(){'disconnected'===k.iceConnectionState&&b.disconnect()},k.onicecandidate=function(a){a.candidate&&onIceCandidate(a,c,k,e)},k.setRemoteDescription(g).then(function(){return k.createAnswer()}).then(function(a){return j=a,k.setLocalDescription(j)}).then(function(){k.acceptedCall=!0,b.callInSession=!0,sendIceCandidates(c,k,e),c.direct.emit(callResponseEvent,{callId:e,acceptedCall:d,description:j})}).catch(function(a){var c=b.ChatEngine;(0,_errorHandlers.chatEngineError)(c,'incomingCall','WebRTC [incomingCall] error.',a)})}else c.direct.emit(callResponseEvent,{callId:e,acceptedCall:d})})}function onIceCandidate(a,b,c,d){c.iceCache.push(a.candidate),c.acceptedCall&&sendIceCandidates(b,c,d)}function sendIceCandidates(a,b,c){a.direct.emit(peerIceCandidateEvent,{callId:c,candidates:b.iceCache}),b.iceCache=[]}function peerIceCandidate(a){var b=this,c=this.peerConnection,d=this.ignoreNonTurn,e=a.data,f=e.callId,g=e.candidates;'object'===('undefined'==typeof g?'undefined':_typeof(g))&&c&&g.forEach(function(a){d&&-1===a.candidate.indexOf('typ relay')||c.addIceCandidate(a).catch(function(a){if('Error processing ICE candidate'!==a.message){(0,_errorHandlers.chatEngineError)(b.ChatEngine,'peerIceCandidate','ChatEngine WebRTC [peerIceCandidate] error.',a)}})})}module.exports=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return config=a,{namespace:'webRTC',extends:{Me:WebRtcPhone}}};

},{"./helpers/error-handlers.js":3,"./helpers/util.js":4}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy5udm0vdmVyc2lvbnMvbm9kZS92OC4xMS4yL2xpYi9ub2RlX21vZHVsZXMvY2hhdC1lbmdpbmUtcGx1Z2luL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIudG1wL3dyYXAuanMiLCJwYWNrYWdlLmpzb24iLCJzcmMvaGVscGVycy9lcnJvci1oYW5kbGVycy5qcyIsInNyYy9oZWxwZXJzL3V0aWwuanMiLCJzcmMvcGx1Z2luLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO2FDQUEsQ0FBQyxVQUFXLENBRVIsR0FBTSxHQUFNLFFBQVEsaUJBQVIsQ0FBWixDQUNBLE9BQU8sY0FBUCxDQUFzQixNQUF0QixDQUE2QixFQUFJLElBQWpDLEVBQXlDLFFBQVEsa0JBQVIsQ0FFNUMsQ0FMRCxHOzs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7YUNSQSxRQUFTLHlCQUFULENBQWtDLENBQWxDLENBQTRDLENBR3hDLGdCQUFnQixLQUFLLFVBQXJCLHVGQUh3QyxDQUl4QyxLQUNILENBUUQsUUFBUyx5QkFBVCxFQUFvQyxDQUdoQyxnQkFBZ0IsS0FBSyxVQUFyQix1RkFDSCxDQVFELFFBQVMsdUJBQVQsRUFBa0MsQ0FHOUIsZ0JBQWdCLEtBQUssVUFBckIsbUZBQ0gsQ0FRRCxRQUFTLHVCQUFULEVBQWtDLENBRzlCLGdCQUFnQixLQUFLLFVBQXJCLG1GQUNILENBZ0JELFFBQVMsZ0JBQVQsQ0FBeUIsQ0FBekIsQ0FBcUMsQ0FBckMsQ0FBbUQsQ0FBbkQsQ0FBNEQsQ0FBNUQsQ0FBbUUsQ0FDL0QsRUFBVSw4QkFBZ0MsR0FBVyxpQkFBM0MsQ0FEcUQsQ0FFL0QsRUFBUSxFQUFRLENBQVIsQ0FBZ0IsQ0FG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aWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBjb25zdCBwa2cgPSByZXF1aXJlKCcuLi9wYWNrYWdlLmpzb24nKTtcbiAgICB3aW5kb3cuQ2hhdEVuZ2luZUNvcmUucGx1Z2luW3BrZy5uYW1lXSA9IHJlcXVpcmUoJy4uL3NyYy9wbHVnaW4uanMnKTtcblxufSkoKTtcbiIsIm1vZHVsZS5leHBvcnRzPXtcbiAgXCJhdXRob3JcIjogXCJBZGFtIEJhdm9zYVwiLFxuICBcIm5hbWVcIjogXCJjaGF0LWVuZ2luZS13ZWJydGNcIixcbiAgXCJ2ZXJzaW9uXCI6IFwiMC4wLjFcIixcbiAgXCJtYWluXCI6IFwic3JjL3BsdWdpbi5qc1wiLFxuICBcImRlcGVuZGVuY2llc1wiOiB7XG4gICAgXCJjaGF0LWVuZ2luZVwiOiBcIl4wLjkuMThcIlxuICB9LFxuICBcImJyb3dzZXJpZnlcIjoge1xuICAgIFwidHJhbnNmb3JtXCI6IFtcbiAgICAgIFtcbiAgICAgICAgXCJiYWJlbGlmeVwiLFxuICAgICAgICB7XG4gICAgICAgICAgXCJwcmVzZXRzXCI6IFtcbiAgICAgICAgICAgIFwiZXMyMDE1XCIsXG4gICAgICAgICAgICBcIm1pbmlmeVwiXG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICBdXG4gICAgXVxuICB9LFxuICBcImRldkRlcGVuZGVuY2llc1wiOiB7XG4gICAgXCJiYWJlbC1jb3JlXCI6IFwiXjYuMjYuM1wiLFxuICAgIFwiYmFiZWwtbWluaWZ5XCI6IFwiXjAuNC4zXCIsXG4gICAgXCJiYWJlbC1wcmVzZXQtZXMyMDE1XCI6IFwiXjYuMjQuMVwiLFxuICAgIFwiYmFiZWxpZnlcIjogXCJeOC4wLjBcIlxuICB9XG59IiwiLyoqXG4gKiBAZmlsZSBGYWxsYmFjayBldmVudCBoYW5kbGVycyBzZXQgaW4gdGhlIFdlYlJUQ0NhbGwgY29uc3RydWN0b3IuIElmIHRoZVxuICogICAgIGNsaWVudCBkb2VzIG5vdCBwcm92aWRlIGFueSBvZiB0aGUgbm90ZWQgZXZlbnQgaGFuZGxlcnMsIHRoZXNlIGZ1bmN0aW9uc1xuICogICAgIHdpbGwgZXhlY3V0ZSBhbmQgdGhyb3cgYSBDaGF0RW5naW5lIGVycm9yIHdpdGggQ2hhdEVuZ2luZS50aHJvd0Vycm9yLlxuICogICAgIEFsdGhvdWdoIHRoaXMuQ2hhdEVuZ2luZSBpcyByZWZlcmVuY2VkLCB0aGVyZSBpcyBubyBuZWVkIHRvIHVzZSB0aGVcbiAqICAgICBKYXZhU2NyaXB0IGNhbGwgb3IgYXBwbHkgbWV0aG9kcyB0aGFua3MgdG8gdGhlIHBsdWdpbiBhcmNoaXRlY3R1cmUuXG4gKiBAYXV0aG9yIEFkYW0gQmF2b3NhIDxhZGFtYkBwdWJudWIuY29tPlxuICovXG5cbi8qKlxuICogQSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCBpZiB0aGUgY2xpZW50IGRpZCBub3QgcGFzcyBhIHBhcmVudCBvbkluY29taW5nQ2FsbFxuICogICAgIGV2ZW50IGhhbmRsZXIgdG8gdGhlIFdlYlJUQyBwbHVnaW4gaW5zdGFuY2UuXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZm9yIG9uSW5jb21pbmdDYWxsLiBBY2NlcHRzIGJvb2xlYW4gZm9yXG4gKiAgICAgYWNjZXB0aW5nIGEgY2FsbC4gVGhlIGNhbGwgaXMgYXV0b21hdGljYWxseSByZWplY3RlZCBiZWNhdXNlIGEgZnVuY3Rpb25cbiAqICAgICBmb3IgVUkgaW5wdXQgKGFjY2VwdC9yZWplY3QpIGlzIG5vdCBkZWZpbmVkLlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5mdW5jdGlvbiBvbkluY29taW5nQ2FsbE5vdERlZmluZWQoY2FsbGJhY2spIHtcbiAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSAnb25JbmNvbWluZ0NhbGxOb3REZWZpbmVkJztcbiAgICBjb25zdCBtZXNzYWdlID0nQSBoYW5kbGVyIGZvciB0aGUgW29uSW5jb21pbmdDYWxsXSBldmVudCBpcyBub3QgZGVmaW5lZC4nO1xuICAgIGNoYXRFbmdpbmVFcnJvcih0aGlzLkNoYXRFbmdpbmUsIGZ1bmN0aW9uTmFtZSwgbWVzc2FnZSk7XG4gICAgY2FsbGJhY2soZmFsc2UpO1xufVxuXG4vKipcbiAqIEEgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgaWYgdGhlIGNsaWVudCBkaWQgbm90IHBhc3MgYW4gb25DYWxsUmVzcG9uc2UgZXZlbnRcbiAqICAgICBoYW5kbGVyIHRvIHRoZSBjYWxsIG9iamVjdCBpbnN0YW5jZS5cbiAqXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZnVuY3Rpb24gb25DYWxsUmVzcG9uc2VOb3REZWZpbmVkKCkge1xuICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9ICdvbkNhbGxSZXNwb25zZU5vdERlZmluZWQnO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSdBIGhhbmRsZXIgZm9yIHRoZSBbb25DYWxsUmVzcG9uc2VdIGV2ZW50IGlzIG5vdCBkZWZpbmVkLic7XG4gICAgY2hhdEVuZ2luZUVycm9yKHRoaXMuQ2hhdEVuZ2luZSwgZnVuY3Rpb25OYW1lLCBtZXNzYWdlKTtcbn1cblxuLyoqXG4gKiBBIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGlmIHRoZSBjbGllbnQgZGlkIG5vdCBwYXNzIGFuIG9uUGVlclN0cmVhbSBldmVudFxuICogICAgIGhhbmRsZXIgdG8gdGhlIGNhbGwgb2JqZWN0IGluc3RhbmNlLlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5mdW5jdGlvbiBvblBlZXJTdHJlYW1Ob3REZWZpbmVkKCkge1xuICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9ICdvblBlZXJTdHJlYW1Ob3REZWZpbmVkJztcbiAgICBjb25zdCBtZXNzYWdlID0gJ0EgaGFuZGxlciBmb3IgdGhlIFtvblBlZXJTdHJlYW1dIGV2ZW50IGlzIG5vdCBkZWZpbmVkLic7XG4gICAgY2hhdEVuZ2luZUVycm9yKHRoaXMuQ2hhdEVuZ2luZSwgZnVuY3Rpb25OYW1lLCBtZXNzYWdlKTtcbn1cblxuLyoqXG4gKiBBIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGlmIHRoZSBjbGllbnQgZGlkIG5vdCBwYXNzIGFuIG9uRGlzY29ubmVjdCBldmVudFxuICogICAgIGhhbmRsZXIgdG8gdGhlIGNhbGwgb2JqZWN0IGluc3RhbmNlLlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5mdW5jdGlvbiBvbkRpc2Nvbm5lY3ROb3REZWZpbmVkKCkge1xuICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9ICdvbkRpc2Nvbm5lY3ROb3REZWZpbmVkJztcbiAgICBjb25zdCBtZXNzYWdlID0gJ0EgaGFuZGxlciBmb3IgdGhlIFtvbkRpc2Nvbm5lY3RdIGV2ZW50IGlzIG5vdCBkZWZpbmVkLic7XG4gICAgY2hhdEVuZ2luZUVycm9yKHRoaXMuQ2hhdEVuZ2luZSwgZnVuY3Rpb25OYW1lLCBtZXNzYWdlKTtcbn1cblxuLyoqXG4gKiBBIGhlbHBlciBmdW5jdGlvbiBmb3IgdGhyb3dpbmcgZXJyb3JzIHdpdGggQ2hhdEVuZ2luZS4gSW4gcHJvZHVjdGlvbiBtb2RlLFxuICogICAgIENoYXRFbmdpbmUgRXJyb3JzIGNhbiBiZSBzdXBwcmVzc2VkLlxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBjaGF0RW5naW5lIENoYXRFbmdpbmUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gZnVuY3Rpb25OYW1lIENoYXRFbmdpbmUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSBDaGF0RW5naW5lIGluc3RhbmNlLlxuICogQHBhcmFtIHtvYmplY3R8c3RyaW5nfSBlcnJvciBOYXR1cmFsIGVycm9yIG9iamVjdCBvciBhIHN0cmluZyBtZXNzYWdlLiBUaGlzXG4gKiAgICAgZ2V0cyBsb2dnZWQgaW4gdGhlIENoYXRFbmdpbmUgZXJyb3IgZXZlbnQgaGlzdG9yeS5cbiAqXG4gKiBAdGhyb3dzIFRocm93cyBhbiBlcnJvciB1c2luZyB0aGUgQ2hhdEVuZ2luZS50aHJvd0Vycm9yIGZ1bmN0aW9uLlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5mdW5jdGlvbiBjaGF0RW5naW5lRXJyb3IoY2hhdEVuZ2luZSwgZnVuY3Rpb25OYW1lLCBtZXNzYWdlLCBlcnJvcikge1xuICAgIG1lc3NhZ2UgPSAnQ2hhdEVuZ2luZSBXZWJSVEMgUGx1Z2luOiAnICsgKG1lc3NhZ2UgfHwgJ3VuZGVmaW5lZCBlcnJvcicpO1xuICAgIGVycm9yID0gZXJyb3IgPyBlcnJvciA6IG1lc3NhZ2U7XG5cbiAgICBjaGF0RW5naW5lLnRocm93RXJyb3IoXG4gICAgICAgIGNoYXRFbmdpbmUsXG4gICAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgJ3dlYlJUQycsXG4gICAgICAgIG5ldyBFcnJvcihtZXNzYWdlKSxcbiAgICAgICAgeyBlcnJvciB9XG4gICAgKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgb25JbmNvbWluZ0NhbGxOb3REZWZpbmVkLFxuICAgIG9uQ2FsbFJlc3BvbnNlTm90RGVmaW5lZCxcbiAgICBvblBlZXJTdHJlYW1Ob3REZWZpbmVkLFxuICAgIG9uRGlzY29ubmVjdE5vdERlZmluZWQsXG4gICAgY2hhdEVuZ2luZUVycm9yXG59O1xuIiwiLyoqXG4gKiBAZmlsZSBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgcGx1Z2luLmpzLlxuICogQGF1dGhvciBBZGFtIEJhdm9zYSA8YWRhbWJAcHVibnViLmNvbT5cbiAqL1xuXG5jb25zdCBwZWVySWNlQ2FuZGlkYXRlRXZlbnQgPSBbJyQnICsgJ3dlYlJUQycsICdwZWVySWNlQ2FuZGlkYXRlJ10uam9pbignLicpO1xuY29uc3QgaW5jb21pbmdDYWxsRXZlbnQgPSBbJyQnICsgJ3dlYlJUQycsICdpbmNvbWluZ0NhbGwnXS5qb2luKCcuJyk7XG5jb25zdCBjYWxsUmVzcG9uc2VFdmVudCA9IFsnJCcgKyAnd2ViUlRDJywgJ2NhbGxSZXNwb25zZSddLmpvaW4oJy4nKTtcblxuLyoqXG4gKiBNYWtlcyBhIG5ldywgdmVyc2lvbiA0LCB1bml2ZXJzYWxseSB1bmlxdWUgaWRlbnRpZmllciAoVVVJRCkuIFdyaXR0ZW4gYnlcbiAqICAgICBTdGFjayBPdmVyZmxvdyB1c2VyIGJyb29mYVxuICogICAgIChodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3VzZXJzLzEwOTUzOC9icm9vZmEpIGluIHRoaXMgcG9zdFxuICogICAgIChodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjExNzUyMy82MTkzNzM2KS5cbiAqXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBBIHZlcnNpb24gNCBjb21wbGlhbnQgVVVJRC5cbiAqL1xuZnVuY3Rpb24gdXVpZCgpIHtcbiAgICByZXR1cm4gKFsxZTddKy0xZTMrLTRlMystOGUzKy0xZTExKS5yZXBsYWNlKFxuICAgICAgICAvWzAxOF0vZyxcbiAgICAgICAgKGMpID0+IChjIF4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgxKSlbMF0gJiAxNSA+PiBjIC8gNClcbiAgICAgICAgICAgIC50b1N0cmluZygxNilcbiAgICApO1xufVxuXG5jb25zdCBldmVudE5hbWVzID0ge1xuICAgIHBlZXJJY2VDYW5kaWRhdGVFdmVudCxcbiAgICBpbmNvbWluZ0NhbGxFdmVudCxcbiAgICBjYWxsUmVzcG9uc2VFdmVudFxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICB1dWlkLFxuICAgIGV2ZW50TmFtZXNcbn07XG4iLCIvKipcbiAqIEBmaWxlIENoYXRFbmdpbmUgcGx1Z2luIGZvciBXZWJSVEMgdmlkZW8gYW5kIGF1ZGlvIGNhbGxpbmcuXG4gKiBAYXV0aG9yIEFkYW0gQmF2b3NhIDxhZGFtYkBwdWJudWIuY29tPlxuICovXG5cbmltcG9ydCB7XG4gICAgb25JbmNvbWluZ0NhbGxOb3REZWZpbmVkLFxuICAgIG9uQ2FsbFJlc3BvbnNlTm90RGVmaW5lZCxcbiAgICBvblBlZXJTdHJlYW1Ob3REZWZpbmVkLFxuICAgIG9uRGlzY29ubmVjdE5vdERlZmluZWQsXG4gICAgY2hhdEVuZ2luZUVycm9yXG59IGZyb20gJy4vaGVscGVycy9lcnJvci1oYW5kbGVycy5qcyc7XG5cbmltcG9ydCB7XG4gICAgdXVpZCxcbiAgICBldmVudE5hbWVzXG59IGZyb20gJy4vaGVscGVycy91dGlsLmpzJztcblxuY29uc3QgaW5jb21pbmdDYWxsRXZlbnQgPSBldmVudE5hbWVzLmluY29taW5nQ2FsbEV2ZW50O1xuY29uc3QgY2FsbFJlc3BvbnNlRXZlbnQgPSBldmVudE5hbWVzLmNhbGxSZXNwb25zZUV2ZW50O1xuY29uc3QgcGVlckljZUNhbmRpZGF0ZUV2ZW50ID0gZXZlbnROYW1lcy5wZWVySWNlQ2FuZGlkYXRlRXZlbnQ7XG5sZXQgY29uZmlnO1xuXG4vKlxuICogV2ViUnRjUGhvbmUgaGFzIGEgYGNvbnN0cnVjdGAgbWV0aG9kIGluc3RlYWQgb2YgYSBjb252ZW50aW9uYWwgYGNvbnN0cnVjdG9yYFxuICogICAgIG1ldGhvZC4gVGhpcyBpcyBjYWxsZWQgZnJvbSB3aXRoaW4gQ2hhdEVuZ2luZSBkdXJpbmcgdGhlIHBsdWdpbiBpbml0XG4gKiAgICAgcHJvY2Vzcy4gVGhlIGNsYXNzIGV4dGVuZHMgYSBDaGF0RW5naW5lIHR5cGUgYmFzZWQgb24gdGhlIG1vZHVsZSBleHBvcnQnc1xuICogICAgIGBleHRlbmRzYC4gVGhpcyBwbHVnaW4gZXh0ZW5kcyBvbmx5IHRoZSBpbnN0YW5jZSBvZiB0aGUgYE1lYCBvYmplY3QgaW5cbiAqICAgICB0aGUgQ2hhdEVuZ2luZSBpbnN0YW5jZS5cbiAqXG4gKiBAY2xhc3NcbiAqIEBjbGFzc2Rlc2MgV2ViUnRjUGhvbmUgY2FuIGV4dGVuZCBhbnkgQ2hhdEVuZ2luZSBjbGFzcyB0eXBlIGFuZCBpdCBzaG91bGQgYmVcbiAqICAgICB1c2VkIGFzIGEgc2luZ2xldG9uLiBCeSBkZWZhdWx0LCBpdCBleHRlbmRzIHRoZSBgTWVgIGluc3RhbmNlIG9mIGFcbiAqICAgICBDaGF0RW5naW5lIGluc3RhbmNlIHVzaW5nIHRoZSBgcGx1Z2luYCBtZXRob2QgZm9yIGluaXRpYWxpemF0aW9uLiBJdCBcbiAqICAgICBleHBvc2VzIGEgYGNhbGxVc2VyYCBhbmQgYSBgZGlzY29ubmVjdGAgbWV0aG9kLiBUaGUgaW5zdGFuY2UgZW5jYXBzdWxhdGVzXG4gKiAgICAgYWxsIHRoZSBuZWNlc3NhcnkgbG9naWMgYW5kIGV2ZW50cyBmb3Igb3JjaGVzdHJhdGluZyBhIFdlYlJUQyBjb25uZWN0aW9uLlxuICogICAgIFRoZSBjbGFzcyBhdHRlbXB0cyBhIHBlZXIgdG8gcGVlciBjb25uZWN0aW9uIGF0IGZpcnN0LiBJdCBjYW4gZmFsbGJhY2sgdG9cbiAqICAgICBhIFRVUk4gY29ubmVjdGlvbiBpZiBzZXJ2ZXIgaW5mb3JtYXRpb24gaXMgcHJvdmlkZWQgaW4gdGhlIGNvbmZpZ3VyYXRpb24uXG4gKiAgICAgQWxsIG9mIHRoZSBXZWJSVEMgc2lnbmFsaW5nIGlzIGRvbmUgdXNpbmcgQ2hhdEVuZ2luZSBgZGlyZWN0YCBldmVudHMuIEZvclxuICogICAgIHRoaXMgcmVhc29uIHVzaW5nIGBvbmAgbWV0aG9kcyBmcm9tIHRoZSBwYXJlbnQgYXJlIG5vdCBlbmNvdXJhZ2VkLCBzb1xuICogICAgIGV2ZW50IGhhbmRsZXJzIGxpa2UgYG9uSW5jb21pbmdDYWxsYCwgYG9uQ2FsbFJlc3BvbnNlYCwgYG9uUGVlclN0cmVhbWAsXG4gKiAgICAgYW5kIGBvbkRpc2Nvbm5lY3RgIG5lZWQgdG8gYmUgcGFzc2VkIHRvIGAgdGhlIGNsYXNzIGluc3RhbmNlLiBFcnJvcnMgYXJlXG4gKiAgICAgbG9nZ2VkIHVzaW5nIGBDaGF0RW5naW5lLnRocm93RXJyb3JgLlxuICovXG5jbGFzcyBXZWJSdGNQaG9uZSB7XG4gICAgLypcbiAgICAgKiBDb25zdHJ1Y3QgaXMgYSBtZXRob2QgY2FsbGVkIGZyb20gQ2hhdEVuZ2luZSBkdXJpbmcgdGhlIHBsdWdpblxuICAgICAqICAgICBpbml0aWFsaXphdGlvbiBwcm9jZXNzLiBJdCBleHRlbmRzIHRoZSBvYmplY3QgdGhhdCBgcGx1Z2luYCBpcyBjYWxsZWRcbiAgICAgKiAgICAgb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbb25JbmNvbWluZ0NhbGxdIEZ1bmN0aW9uIHBhc3NlZCBmcm9tIHRoZSBwYXJlbnQgdGhhdFxuICAgICAqICAgICBleGVjdXRlcyB3aGVuIGEgYGRpcmVjdGAgZXZlbnQgZmlyZXMgZm9yIGFuIGluY29taW5nIFdlYlJUQyBjYWxsLiBJZlxuICAgICAqICAgICBhIGhhbmRsZXIgaXMgbm90IHBhc3NlZCBpbiB0aGUgcGx1Z2luIGNvbmZpZ3VyYXRpb24sIGFuIGVycm9yIHdpbGwgYmVcbiAgICAgKiAgICAgdGhyb3duIGV2ZXJ5IHRpbWUgdGhlIGV2ZW50IGZpcmVzLlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtvbkNhbGxSZXNwb25zZV0gRnVuY3Rpb24gcGFzc2VkIGZyb20gdGhlIHBhcmVudCB0aGF0XG4gICAgICogICAgIGV4ZWN1dGVzIHdoZW4gYSBgZGlyZWN0YCBldmVudCBmaXJlcyBmb3IgYSBjYWxsIHJlcGx5LiBJZiBhIGhhbmRsZXJcbiAgICAgKiAgICAgaXMgbm90IHBhc3NlZCBpbiB0aGUgcGx1Z2luIGNvbmZpZ3VyYXRpb24sIGFuIGVycm9yIHdpbGwgYmUgdGhyb3duXG4gICAgICogICAgIGV2ZXJ5IHRpbWUgdGhlIGV2ZW50IGZpcmVzLlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtvblBlZXJTdHJlYW1dIEZ1bmN0aW9uIHBhc3NlZCBmcm9tIHRoZSBwYXJlbnQgdGhhdFxuICAgICAqICAgICBleGVjdXRlcyB3aGVuIGEgdGhlIHBlZXIncyBzdHJlYW0gb2JqZWN0IGJlY29tZXMgYXZhaWxhYmxlLiBJZiBhXG4gICAgICogICAgIGhhbmRsZXIgaXMgbm90IHBhc3NlZCBpbiB0aGUgcGx1Z2luIGNvbmZpZ3VyYXRpb24sIGFuIGVycm9yIHdpbGwgYmVcbiAgICAgKiAgICAgdGhyb3duIGV2ZXJ5IHRpbWUgdGhlIGV2ZW50IGZpcmVzLlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtvbkRpc2Nvbm5lY3RdIEZ1bmN0aW9uIHBhc3NlZCBmcm9tIHRoZSBwYXJlbnQgdGhhdFxuICAgICAqICAgICBleGVjdXRlcyB3aGVuIGEgdXNlciBpbiB0aGUgY2FsbCBkaXNjb25uZWN0cy4gSWYgYSBoYW5kbGVyIGlzIG5vdFxuICAgICAqICAgICBwYXNzZWQgaW4gdGhlIHBsdWdpbiBjb25maWd1cmF0aW9uLCBhbiBlcnJvciB3aWxsIGJlIHRocm93biBldmVyeVxuICAgICAqICAgICB0aW1lIHRoZSBldmVudCBmaXJlcy5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW215U3RyZWFtXSBBIGJyb3dzZXIgYE1lZGlhU3RyZWFtYCBvYmplY3Qgb2YgdGhlIGxvY2FsXG4gICAgICogICAgIGNsaWVudCBhdWRpbyBhbmQvb3IgdmlkZW8uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtydGNDb25maWddIEFuIGBSVENDb25maWd1cmF0aW9uYCBkaWN0aW9uYXJ5IHRoYXQgaXMgdXNlZFxuICAgICAqICAgICB0byBpbml0aWFsaXplIHRoZSBgUlRDUGVlckNvbm5lY3Rpb25gLiBUaGlzIGlzIHdoZXJlIFNUVU4gYW5kIFRVUk5cbiAgICAgKiAgICAgc2VydmVyIGluZm9ybWF0aW9uIHNob3VsZCBiZSBwcm92aWRlZC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpZ25vcmVOb25UdXJuXSBJZiB0cnVlLCB0aGlzIHdpbGwgZm9yY2UgdGhlIElDRVxuICAgICAqICAgICBjYW5kaWRhdGUgcmVnaXN0cmF0aW9uIHRvIGlnbm9yZSBhbGwgY2FuZGlkYXRlcyB0aGF0IGFyZSBub3QgVFVSTiBcbiAgICAgKiAgICAgc2VydmVycy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHt2b2lkfVxuICAgICAqL1xuICAgIGNvbnN0cnVjdCgpIHtcbiAgICAgICAgdGhpcy5vbkluY29taW5nQ2FsbCA9IGNvbmZpZy5vbkluY29taW5nQ2FsbCB8fCBvbkluY29taW5nQ2FsbE5vdERlZmluZWQ7XG4gICAgICAgIHRoaXMub25DYWxsUmVzcG9uc2UgPSBjb25maWcub25DYWxsUmVzcG9uc2UgfHwgb25DYWxsUmVzcG9uc2VOb3REZWZpbmVkO1xuICAgICAgICB0aGlzLm9uUGVlclN0cmVhbSA9IGNvbmZpZy5vblBlZXJTdHJlYW0gfHwgb25QZWVyU3RyZWFtTm90RGVmaW5lZDtcbiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3QgPSBjb25maWcub25EaXNjb25uZWN0IHx8IG9uRGlzY29ubmVjdE5vdERlZmluZWQ7XG4gICAgICAgIHRoaXMubXlTdHJlYW0gPSBjb25maWcubXlTdHJlYW07XG4gICAgICAgIHRoaXMucnRjQ29uZmlnID0gY29uZmlnLnJ0Y0NvbmZpZztcbiAgICAgICAgdGhpcy5pZ25vcmVOb25UdXJuID0gY29uZmlnLmlnbm9yZU5vblR1cm47XG5cbiAgICAgICAgLy8gQ2hhdEVuZ2luZSBEaXJlY3QgZXZlbnQgaGFuZGxlciBmb3IgaW5jb21pbmcgY2FsbCByZXF1ZXN0cy5cbiAgICAgICAgdGhpcy5DaGF0RW5naW5lLm1lLmRpcmVjdC5vbihpbmNvbWluZ0NhbGxFdmVudCwgKHBheWxvYWQpID0+IHtcbiAgICAgICAgICAgIGluY29taW5nQ2FsbC5jYWxsKHRoaXMsIHBheWxvYWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGF0RW5naW5lIERpcmVjdCBldmVudCBoYW5kbGVyIGZvciBjYWxsIHJlc3BvbnNlcy5cbiAgICAgICAgdGhpcy5DaGF0RW5naW5lLm1lLmRpcmVjdC5vbihjYWxsUmVzcG9uc2VFdmVudCwgKHBheWxvYWQpID0+IHtcbiAgICAgICAgICAgIGNhbGxSZXNwb25zZS5jYWxsKHRoaXMsIHBheWxvYWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDaGF0RW5naW5lIERpcmVjdCBldmVudCBoYW5kbGVyIGZvciByZWNlaXZpbmcgbmV3IHBlZXIgSUNFIGNhbmRpZGF0ZXNcbiAgICAgICAgdGhpcy5DaGF0RW5naW5lLm1lLmRpcmVjdC5vbihwZWVySWNlQ2FuZGlkYXRlRXZlbnQsIChwYXlsb2FkKSA9PiB7XG4gICAgICAgICAgICBwZWVySWNlQ2FuZGlkYXRlLmNhbGwodGhpcywgcGF5bG9hZCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogSW5pdGlhbGl6ZSBhIFdlYlJUQyBjYWxsIHdpdGggYW5vdGhlciBDaGF0RW5naW5lIHVzZXIgdGhhdCBpcyBvbmxpbmUuXG4gICAgICogICAgIFRoaXMgaXMgY2FsbGVkIGZyb20gcGFyZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHVzZXIgQ2hhdEVuZ2luZSB1c2VyIG9iamVjdCBvZiB0aGUgdXNlciB0aGlzIGNsaWVudFxuICAgICAqICAgICBpbnRlbmRzIHRvIGNhbGwuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG9iamVjdFxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IG9iamVjdC5vblBlZXJTdHJlYW0gRXZlbnQgaGFuZGxlciBmb3Igd2hlbiBhIHBlZXInc1xuICAgICAqICAgICBzdHJlYW0gYmVjb21lcyBhdmFpbGFibGUuIFRoaXMgd2lsbCBvdmVyd3JpdGUgYSBoYW5kbGVyIHRoYXQgd2FzXG4gICAgICogICAgIHBhc3NlZCBvbiBpbml0aWFsaXphdGlvbi5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gb2JqZWN0Lm15U3RyZWFtIEEgYnJvd3NlciBgTWVkaWFTdHJlYW1gIG9iamVjdCBvZiB0aGVcbiAgICAgKiAgICAgbG9jYWwgY2xpZW50IGF1ZGlvIGFuZC9vciB2aWRlby4gVGhpcyB3aWxsIG92ZXJ3cml0ZSBhIHN0cmVhbSB0aGF0XG4gICAgICogICAgIHdhcyBwYXNzZWQgb24gaW5pdGlhbGl6YXRpb24uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG9iamVjdC5vZmZlck9wdGlvbnMgQW4gYFJUQ09mZmVyT3B0aW9uc2AgZGljdGlvbmFyeSB0aGF0XG4gICAgICogICAgIHNwZWNpZmllcyBhdWRpbyBhbmQvb3IgdmlkZW8gZm9yIHRoZSBwZWVyIGNvbm5lY3Rpb24gb2ZmZXIuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG9iamVjdC5ydGNDb25maWcgQW4gYFJUQ0NvbmZpZ3VyYXRpb25gIGRpY3Rpb25hcnkgdGhhdCBpc1xuICAgICAqICAgICB1c2VkIHRvIGluaXRpYWxpemUgdGhlIGBSVENQZWVyQ29ubmVjdGlvbmAuIFRoaXMgd2lsbCBvdmVyd3JpdGUgYW5cbiAgICAgKiAgICAgYHJ0Y0NvbmZpZ2AgdGhhdCB3YXMgcGFzc2VkIG9uIGluaXRpYWxpemF0aW9uLlxuICAgICAqXG4gICAgICogQHJldHVybnMge3ZvaWR9XG4gICAgICovXG4gICAgY2FsbFVzZXIodXNlciwgeyBvblBlZXJTdHJlYW0sIG15U3RyZWFtLCBvZmZlck9wdGlvbnMsIHJ0Y0NvbmZpZyB9KSB7XG4gICAgICAgIHJ0Y0NvbmZpZyA9IHRoaXMucnRjQ29uZmlnID0gcnRjQ29uZmlnIHx8IHRoaXMucnRjQ29uZmlnO1xuICAgICAgICBteVN0cmVhbSA9IHRoaXMubXlTdHJlYW0gPSBteVN0cmVhbSB8fCB0aGlzLm15U3RyZWFtO1xuICAgICAgICBvblBlZXJTdHJlYW0gPSB0aGlzLm9uUGVlclN0cmVhbSA9IG9uUGVlclN0cmVhbSB8fCB0aGlzLm9uUGVlclN0cmVhbTtcbiAgICAgICAgb2ZmZXJPcHRpb25zID0gb2ZmZXJPcHRpb25zIHx8IHtcbiAgICAgICAgICAgIG9mZmVyVG9SZWNlaXZlQXVkaW86IDEsXG4gICAgICAgICAgICBvZmZlclRvUmVjZWl2ZVZpZGVvOiAxXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHBlZXJDb25uZWN0aW9uID0gdGhpcy5wZWVyQ29ubmVjdGlvblxuICAgICAgICAgICAgPSBuZXcgUlRDUGVlckNvbm5lY3Rpb24ocnRjQ29uZmlnKTtcbiAgICAgICAgY29uc3QgY2FsbElkID0gdGhpcy5jYWxsSWQgPSB1dWlkKCk7IC8vIENhbGwgSURcbiAgICAgICAgbGV0IGxvY2FsRGVzY3JpcHRpb247IC8vIFdlYlJUQyBsb2NhbCBkZXNjcmlwdGlvblxuICAgICAgICBwZWVyQ29ubmVjdGlvbi5vbnRyYWNrID0gb25QZWVyU3RyZWFtO1xuICAgICAgICBteVN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKCh0cmFjaykgPT4ge1xuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24uYWRkVHJhY2sodHJhY2ssIG15U3RyZWFtKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHBlZXJDb25uZWN0aW9uLmljZUNhY2hlID0gW107XG5cbiAgICAgICAgcGVlckNvbm5lY3Rpb24ub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAocGVlckNvbm5lY3Rpb24uaWNlQ29ubmVjdGlvblN0YXRlID09PSAnZGlzY29ubmVjdGVkJykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFdoZW4gSUNFIGNhbmRpZGF0ZXMgYmVjb21lIGF2YWlsYWJsZSwgc2VuZCB0aGVtIHRvIHRoZSBwZWVyIGNsaWVudC5cbiAgICAgICAgcGVlckNvbm5lY3Rpb24ub25pY2VjYW5kaWRhdGUgPSAoaWNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmICghaWNlRXZlbnQuY2FuZGlkYXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb25JY2VDYW5kaWRhdGUoaWNlRXZlbnQsIHVzZXIsIHBlZXJDb25uZWN0aW9uLCBjYWxsSWQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHBlZXJDb25uZWN0aW9uLm9ubmVnb3RpYXRpb25uZWVkZWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5jcmVhdGVPZmZlcihvZmZlck9wdGlvbnMpXG4gICAgICAgICAgICAudGhlbigoZGVzY3JpcHRpb24pID0+IHtcbiAgICAgICAgICAgICAgICBsb2NhbERlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBlZXJDb25uZWN0aW9uLnNldExvY2FsRGVzY3JpcHRpb24obG9jYWxEZXNjcmlwdGlvbik7XG4gICAgICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB1c2VyLmRpcmVjdC5lbWl0KGluY29taW5nQ2FsbEV2ZW50LCB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxJZCxcbiAgICAgICAgICAgICAgICAgICAgcnRjQ29uZmlnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogbG9jYWxEZXNjcmlwdGlvblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gJ2NhbGxVc2VyJztcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gYFdlYlJUQyBbJHtmdW5jdGlvbk5hbWV9XSBlcnJvci5gO1xuICAgICAgICAgICAgICAgIGNoYXRFbmdpbmVFcnJvcih0aGlzLkNoYXRFbmdpbmUsIGZ1bmN0aW9uTmFtZSwgbWVzc2FnZSwgZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBHcmFjZWZ1bGx5IGNsb3NlcyB0aGUgY3VycmVudGx5IG9wZW4gV2ViUlRDIGNhbGwuIFRoaXMgaXMgY2FsbGVkIGZyb21cbiAgICAgKiAgICAgcGFyZW50LlxuICAgICAqXG4gICAgICogQHJldHVybnMge3ZvaWR9XG4gICAgICovXG4gICAgZGlzY29ubmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMucGVlckNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uY2xvc2UoKTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBlZXJDb25uZWN0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jYWxsSW5TZXNzaW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25EaXNjb25uZWN0KCk7XG4gICAgfVxufVxuXG4vKlxuICogVGhpcyBldmVudCBmaXJlcyB3aGVuIHRoZSBjYWxsIHBlZXIgaGFzIGluZGljYXRlZCB3aGV0aGVyIHRoZXkgd2lsbCBhY2NlcHQgb3JcbiAqICAgICByZWplY3QgYW4gaW5jb21pbmcgY2FsbC4gVGhlIHRyaWdnZXIgaXMgYSBDaGF0RW5naW5lIGBkaXJlY3RgIGV2ZW50IGluXG4gKiAgICAgdGhlIFdlYlJ0Y1Bob25lIGNsYXNzLlxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBwYXlsb2FkIEEgQ2hhdEVuZ2luZSBgZGlyZWN0YCBldmVudCBwYXlsb2FkLlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5mdW5jdGlvbiBjYWxsUmVzcG9uc2UocGF5bG9hZCkge1xuICAgIGNvbnN0IHsgY2FsbElkLCBhY2NlcHRlZENhbGwgfSA9IHBheWxvYWQuZGF0YTtcbiAgICBjb25zdCByZW1vdGVEZXNjcmlwdGlvbiA9IHBheWxvYWQuZGF0YS5kZXNjcmlwdGlvbjtcbiAgICBsZXQgc2VuZGVyID0gcGF5bG9hZC5zZW5kZXI7XG5cbiAgICBpZiAoYWNjZXB0ZWRDYWxsKSB7XG4gICAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uYWNjZXB0ZWRDYWxsID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jYWxsSW5TZXNzaW9uID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLnBlZXJDb25uZWN0aW9uLnNldFJlbW90ZURlc2NyaXB0aW9uKHJlbW90ZURlc2NyaXB0aW9uKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNlbmRJY2VDYW5kaWRhdGVzKHNlbmRlciwgdGhpcy5wZWVyQ29ubmVjdGlvbiwgY2FsbElkKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gJ2NhbGxSZXNwb25zZSc7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGBXZWJSVEMgWyR7ZnVuY3Rpb25OYW1lfV0gZXJyb3IuYDtcbiAgICAgICAgICAgICAgICBjaGF0RW5naW5lRXJyb3IodGhpcy5DaGF0RW5naW5lLCBmdW5jdGlvbk5hbWUsIG1lc3NhZ2UsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMub25DYWxsUmVzcG9uc2UoYWNjZXB0ZWRDYWxsKTtcbn1cblxuLypcbiAqIFRoaXMgZXZlbnQgZmlyZXMgd2hlbiBhIGNhbGwgcGVlciBoYXMgYXR0ZW1wdGVkIHRvIGluaXRpYXRlIGEgY2FsbC4gVGhlXG4gKiAgICAgIHRyaWdnZXIgaXMgYSBDaGF0RW5naW5lIGBkaXJlY3RgIGV2ZW50IGluIHRoZSBXZWJSdGNQaG9uZSBjbGFzcy5cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gcGF5bG9hZCBBIENoYXRFbmdpbmUgYGRpcmVjdGAgZXZlbnQgcGF5bG9hZC5cbiAqXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZnVuY3Rpb24gaW5jb21pbmdDYWxsKHBheWxvYWQpIHtcbiAgICBjb25zdCBzZW5kZXIgPSBwYXlsb2FkLnNlbmRlcjtcbiAgICBjb25zdCB7IGNhbGxJZCwgcnRjQ29uZmlnIH0gPSBwYXlsb2FkLmRhdGE7XG4gICAgY29uc3QgcmVtb3RlRGVzY3JpcHRpb24gPSBwYXlsb2FkLmRhdGEuZGVzY3JpcHRpb247XG5cbiAgICAvLyBJcyBleGVjdXRlZCBhZnRlciB0aGlzIGNsaWVudCBhY2NlcHRzIG9yIHJlamVjdHMgYW4gaW5jb21pbmcgY2FsbCwgd2hpY2hcbiAgICAvLyBpcyB0eXBpY2FsbHkgZG9uZSBpbiB0aGVpciBVSS5cbiAgICBjb25zdCBjYWxsUmVzcG9uc2VDYWxsYmFjayA9IChwYXJhbXMpID0+IHtcbiAgICAgICAgbGV0IHsgYWNjZXB0ZWRDYWxsLCBvblBlZXJTdHJlYW0sIG15U3RyZWFtIH0gPSBwYXJhbXM7XG4gICAgICAgIG15U3RyZWFtID0gdGhpcy5teVN0cmVhbSA9IG15U3RyZWFtIHx8IHRoaXMubXlTdHJlYW07XG4gICAgICAgIG9uUGVlclN0cmVhbSA9IG9uUGVlclN0cmVhbSB8fCB0aGlzLm9uUGVlclN0cmVhbTtcblxuICAgICAgICBpZiAoYWNjZXB0ZWRDYWxsKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG15U3RyZWFtICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9ICdpbmNvbWluZ0NhbGwnO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgV2ViUlRDIFske2Z1bmN0aW9uTmFtZX1dOmAgK1xuICAgICAgICAgICAgICAgICAgICBgTm8gbG9jYWwgdmlkZW8gc3RyZWFtIGRlZmluZWQuYDtcbiAgICAgICAgICAgICAgICBjaGF0RW5naW5lRXJyb3IodGhpcy5DaGF0RW5naW5lLCBmdW5jdGlvbk5hbWUsIG1lc3NhZ2UsIGVycm9yKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IGxvY2FsRGVzY3JpcHRpb247XG4gICAgICAgICAgICBjb25zdCBwZWVyQ29ubmVjdGlvbiA9IHRoaXMucGVlckNvbm5lY3Rpb25cbiAgICAgICAgICAgICAgICA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbihydGNDb25maWcpO1xuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24ub250cmFjayA9IG9uUGVlclN0cmVhbTtcbiAgICAgICAgICAgIHBlZXJDb25uZWN0aW9uLmljZUNhY2hlID0gW107XG4gICAgICAgICAgICBteVN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKCh0cmFjaykgPT4ge1xuICAgICAgICAgICAgICAgIHBlZXJDb25uZWN0aW9uLmFkZFRyYWNrKHRyYWNrLCBteVN0cmVhbSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24ub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHBlZXJDb25uZWN0aW9uLmljZUNvbm5lY3Rpb25TdGF0ZSA9PT0gJ2Rpc2Nvbm5lY3RlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gU2VuZCBJQ0UgY2FuZGlkYXRlcyB0byBwZWVyIGFzIHRoZXkgY29tZSBhdmFpbGFibGUgbG9jYWxseS5cbiAgICAgICAgICAgIHBlZXJDb25uZWN0aW9uLm9uaWNlY2FuZGlkYXRlID0gKGljZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFpY2VFdmVudC5jYW5kaWRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9uSWNlQ2FuZGlkYXRlKGljZUV2ZW50LCBzZW5kZXIsIHBlZXJDb25uZWN0aW9uLCBjYWxsSWQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcGVlckNvbm5lY3Rpb24uc2V0UmVtb3RlRGVzY3JpcHRpb24ocmVtb3RlRGVzY3JpcHRpb24pXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGVlckNvbm5lY3Rpb24uY3JlYXRlQW5zd2VyKCk7XG4gICAgICAgICAgICAgICAgfSkudGhlbigoYW5zd2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRGVzY3JpcHRpb24gPSBhbnN3ZXI7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwZWVyQ29ubmVjdGlvbi5zZXRMb2NhbERlc2NyaXB0aW9uKGxvY2FsRGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwZWVyQ29ubmVjdGlvbi5hY2NlcHRlZENhbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxJblNlc3Npb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzZW5kSWNlQ2FuZGlkYXRlcyhzZW5kZXIsIHBlZXJDb25uZWN0aW9uLCBjYWxsSWQpO1xuICAgICAgICAgICAgICAgICAgICBzZW5kZXIuZGlyZWN0LmVtaXQoY2FsbFJlc3BvbnNlRXZlbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdGVkQ2FsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBsb2NhbERlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGF0RW5naW5lID0gdGhpcy5DaGF0RW5naW5lO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSAnaW5jb21pbmdDYWxsJztcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGBXZWJSVEMgWyR7ZnVuY3Rpb25OYW1lfV0gZXJyb3IuYDtcbiAgICAgICAgICAgICAgICAgICAgY2hhdEVuZ2luZUVycm9yKGNoYXRFbmdpbmUsIGZ1bmN0aW9uTmFtZSwgbWVzc2FnZSwgZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VuZGVyLmRpcmVjdC5lbWl0KGNhbGxSZXNwb25zZUV2ZW50LCB7XG4gICAgICAgICAgICAgICAgY2FsbElkLFxuICAgICAgICAgICAgICAgIGFjY2VwdGVkQ2FsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLm9uSW5jb21pbmdDYWxsKHNlbmRlciwgY2FsbFJlc3BvbnNlQ2FsbGJhY2spO1xufVxuXG4vKlxuICogVGhpcyBldmVudCBmaXJlcyB3aGVuIHRoZSBsb2NhbCBXZWJSVEMgY29ubmVjdGlvbiBoYXMgcmVjZWl2ZWQgYSBuZXcgSUNFXG4gKiAgICAgY2FuZGlkYXRlLlxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBpY2VFdmVudCBBIGBSVENQZWVyQ29ubmVjdGlvbkljZUV2ZW50YCBmb3IgdGhlIGxvY2FsIGNsaWVudC5cbiAqIEBwYXJhbSB7b2JqZWN0fSB1c2VyIEEgQ2hhdEVuZ2luZSB1c2VyIG9iamVjdCBmb3IgdGhlIHBlZXIgdG8gc2VuZCB0aGUgSUNFXG4gKiAgICAgY2FuZGlkYXRlIHRvLlxuICogQHBhcmFtIHtvYmplY3R9IHBlZXJDb25uZWN0aW9uIFRoZSBsb2NhbCBgUlRDUGVlckNvbm5lY3Rpb25gIG9iamVjdC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjYWxsSWQgQSBVVUlEIGZvciB0aGUgdW5pcXVlIGNhbGwuXG4gKlxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmZ1bmN0aW9uIG9uSWNlQ2FuZGlkYXRlKGljZUV2ZW50LCB1c2VyLCBwZWVyQ29ubmVjdGlvbiwgY2FsbElkKSB7XG4gICAgcGVlckNvbm5lY3Rpb24uaWNlQ2FjaGUucHVzaChpY2VFdmVudC5jYW5kaWRhdGUpO1xuICAgIGlmIChwZWVyQ29ubmVjdGlvbi5hY2NlcHRlZENhbGwpIHtcbiAgICAgICAgc2VuZEljZUNhbmRpZGF0ZXModXNlciwgcGVlckNvbm5lY3Rpb24sIGNhbGxJZCk7XG4gICAgfVxufVxuXG4vKlxuICogVGhpcyBzZW5kcyBhbiBhcnJheSBvZiBJQ0UgY2FuZGlkYXRlc1xuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSB1c2VyIEEgQ2hhdEVuZ2luZSB1c2VyIG9iamVjdCBmb3IgdGhlIHBlZXIgdG8gc2VuZCB0aGUgSUNFXG4gKiAgICAgY2FuZGlkYXRlIHRvLlxuICogQHBhcmFtIHtvYmplY3R9IHBlZXJDb25uZWN0aW9uIFRoZSBsb2NhbCBgUlRDUGVlckNvbm5lY3Rpb25gIG9iamVjdC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjYWxsSWQgQSBVVUlEIGZvciB0aGUgdW5pcXVlIGNhbGwuXG4gKlxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmZ1bmN0aW9uIHNlbmRJY2VDYW5kaWRhdGVzKHVzZXIsIHBlZXJDb25uZWN0aW9uLCBjYWxsSWQpIHtcbiAgICB1c2VyLmRpcmVjdC5lbWl0KHBlZXJJY2VDYW5kaWRhdGVFdmVudCwge1xuICAgICAgICBjYWxsSWQsXG4gICAgICAgIGNhbmRpZGF0ZXM6IHBlZXJDb25uZWN0aW9uLmljZUNhY2hlXG4gICAgfSk7XG5cbiAgICAvLyBQdXJnZSBJQ0UgY2FuZGlkYXRlIGNhY2hlIGFmdGVyIGl0IGdldHMgc2VudCB0byBwZWVyLlxuICAgIHBlZXJDb25uZWN0aW9uLmljZUNhY2hlID0gW107XG59XG5cbi8qXG4gKiBUaGlzIGV2ZW50IGZpcmVzIHdoZW4gdGhlIHBlZXIgV2ViUlRDIGNsaWVudCBzZW5kcyBhIG5ldyBJQ0UgY2FuZGlkYXRlLiBUaGlzXG4gKiAgICAgZXZlbnQgcmVnaXN0ZXJzIHRoZSBjYW5kaWRhdGUgd2l0aCB0aGUgbG9jYWwgYFJUQ1BlZXJDb25uZWN0aW9uYCBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHBheWxvYWQgQSBDaGF0RW5naW5lIGBkaXJlY3RgIGV2ZW50IHBheWxvYWQuXG4gKlxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmZ1bmN0aW9uIHBlZXJJY2VDYW5kaWRhdGUocGF5bG9hZCkge1xuICAgIGNvbnN0IHsgcGVlckNvbm5lY3Rpb24sIGlnbm9yZU5vblR1cm4gfSA9IHRoaXM7XG4gICAgY29uc3QgeyBjYWxsSWQsIGNhbmRpZGF0ZXMgfSA9IHBheWxvYWQuZGF0YTtcblxuICAgIGlmICh0eXBlb2YgY2FuZGlkYXRlcyAhPT0gJ29iamVjdCcgfHwgIXBlZXJDb25uZWN0aW9uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjYW5kaWRhdGVzLmZvckVhY2goKGNhbmRpZGF0ZSkgPT4ge1xuICAgICAgICAvLyBJZ25vcmUgYWxsIG5vbi1UVVJOIElDRSBjYW5kaWRhdGVzIGlmIHNwZWNpZmllZCBpbiBjb25maWcuXG4gICAgICAgIGlmIChpZ25vcmVOb25UdXJuICYmIGNhbmRpZGF0ZS5jYW5kaWRhdGUuaW5kZXhPZigndHlwIHJlbGF5JykgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBwZWVyQ29ubmVjdGlvbi5hZGRJY2VDYW5kaWRhdGUoY2FuZGlkYXRlKVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIE5vIG5lZWQgdG8gbG9nIGVycm9ycyBmb3IgaW52YWxpZCBJQ0UgY2FuZGlkYXRlc1xuICAgICAgICAgICAgICAgIGlmIChlcnJvci5tZXNzYWdlID09PSAnRXJyb3IgcHJvY2Vzc2luZyBJQ0UgY2FuZGlkYXRlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gJ3BlZXJJY2VDYW5kaWRhdGUnO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgQ2hhdEVuZ2luZSBXZWJSVEMgWyR7ZnVuY3Rpb25OYW1lfV0gZXJyb3IuYDtcbiAgICAgICAgICAgICAgICBjaGF0RW5naW5lRXJyb3IodGhpcy5DaGF0RW5naW5lLCBmdW5jdGlvbk5hbWUsIG1lc3NhZ2UsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IChjb25maWd1cmF0aW9uID0ge30pID0+IHtcbiAgICBjb25maWcgPSBjb25maWd1cmF0aW9uO1xuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWVzcGFjZTogJ3dlYlJUQycsXG4gICAgICAgIGV4dGVuZHM6IHtcbiAgICAgICAgICAgIE1lOiBXZWJSdGNQaG9uZVxuICAgICAgICB9XG4gICAgfVxufTtcbiJdfQ==
